# ðŸš¨ SUPPRESSION IMMÃ‰DIATE DU MALWARE

## âš¡ Commandes Ã  exÃ©cuter MAINTENANT sur le serveur

### 1. Supprimer immÃ©diatement les fichiers malveillants

```bash
# ArrÃªter tous les processus malveillants
pkill -9 -f xmrig 2>/dev/null
pkill -9 -f moneroocean 2>/dev/null
pkill -9 -f miner 2>/dev/null
pkill -9 -f scanner_linux 2>/dev/null
pkill -9 -f systemwatcher 2>/dev/null

# Supprimer les fichiers malveillants connus
cd ~/bbyatchv2-master
rm -rf xmrig-6.21.0 xmrig.tar.gz monitor.log exploited.log failed.log scanner_deployed.log 2>/dev/null
rm -f scanner_linux systemwatcher 2>/dev/null

# Supprimer dans /tmp et /var/tmp
sudo rm -rf /tmp/xmrig* /tmp/scanner_linux /tmp/systemwatcher 2>/dev/null
sudo rm -rf /var/tmp/xmrig* /var/tmp/scanner_linux /var/tmp/systemwatcher 2>/dev/null

# Supprimer dans le home
rm -rf ~/xmrig* ~/moneroocean ~/miner* 2>/dev/null
rm -f ~/scanner_linux ~/systemwatcher ~/monitor.log ~/exploited.log ~/failed.log ~/scanner_deployed.log 2>/dev/null
```

### 2. Nettoyer les crontabs

```bash
# Nettoyer le crontab utilisateur
crontab -l 2>/dev/null | grep -vE "(xmrig|moneroocean|miner|wget.*sh|curl.*sh|178\.16\.52\.253|1utig|tli\.sh)" | crontab -

# VÃ©rifier le crontab systÃ¨me
sudo grep -E "(xmrig|moneroocean|miner)" /etc/crontab 2>/dev/null
```

### 3. ArrÃªter et supprimer le service systemd suspect

```bash
# ArrÃªter le service malware-protection (qui pourrait Ãªtre compromis)
sudo systemctl stop malware-protection.service 2>/dev/null
sudo systemctl stop malware-protection.timer 2>/dev/null
sudo systemctl disable malware-protection.service 2>/dev/null
sudo systemctl disable malware-protection.timer 2>/dev/null

# Supprimer les fichiers du service
sudo rm -f /etc/systemd/system/malware-protection.service
sudo rm -f /etc/systemd/system/malware-protection.timer
sudo rm -f /usr/local/bin/malware-protection.sh
sudo systemctl daemon-reload
```

### 4. ExÃ©cuter le script de nettoyage complet

```bash
cd ~/bbyatchv2-master
bash cleanup-malware-complete.sh
```

### 5. Installer la protection automatique amÃ©liorÃ©e

```bash
cd ~/bbyatchv2-master

# Rendre le script exÃ©cutable
chmod +x monitor-malware.sh

# CrÃ©er le service systemd de protection
sudo tee /etc/systemd/system/malware-protection.service > /dev/null << 'EOF'
[Unit]
Description=Protection automatique contre le malware
After=network.target

[Service]
Type=oneshot
ExecStart=/bin/bash /home/ec2-user/bbyatchv2-master/monitor-malware.sh
User=root

[Install]
WantedBy=multi-user.target
EOF

# CrÃ©er le timer (exÃ©cution toutes les 2 minutes)
sudo tee /etc/systemd/system/malware-protection.timer > /dev/null << 'EOF'
[Unit]
Description=Timer pour la protection contre le malware
Requires=malware-protection.service

[Timer]
OnBootSec=1min
OnUnitActiveSec=2min
Unit=malware-protection.service

[Install]
WantedBy=timers.target
EOF

# Activer et dÃ©marrer le timer
sudo systemctl daemon-reload
sudo systemctl enable malware-protection.timer
sudo systemctl start malware-protection.timer

# VÃ©rifier que le timer est actif
sudo systemctl status malware-protection.timer
```

### 6. VÃ©rifier que tout est propre

```bash
# VÃ©rifier les processus
ps aux | grep -E "(xmrig|moneroocean|miner|scanner_linux|systemwatcher)" | grep -v grep

# VÃ©rifier les fichiers
ls -la ~/bbyatchv2-master/ | grep -E "(xmrig|monitor|exploited|failed|scanner)"

# VÃ©rifier les crontabs
crontab -l

# VÃ©rifier les services
sudo systemctl list-units --type=service --all | grep -E "(malware|xmrig|miner)"
```

## âœ… Protection automatique activÃ©e

Le script `monitor-malware.sh` s'exÃ©cutera automatiquement **toutes les 2 minutes** et :
- âœ… Tuera automatiquement tous les processus malveillants
- âœ… Supprimera automatiquement tous les fichiers malveillants connus
- âœ… Nettoiera automatiquement les crontabs suspects
- âœ… Logguera toutes les actions dans `/var/log/malware-protection.log`

## ðŸ“‹ VÃ©rification des logs

```bash
# Voir les logs de protection
sudo tail -f /var/log/malware-protection.log

# Voir l'historique du timer
sudo journalctl -u malware-protection.timer -n 50

# Voir les exÃ©cutions du service
sudo journalctl -u malware-protection.service -n 50
```

## ðŸ”’ Actions supplÃ©mentaires recommandÃ©es

1. **Changer tous les mots de passe** (SSH, utilisateur, etc.)
2. **VÃ©rifier les clÃ©s SSH autorisÃ©es** : `cat ~/.ssh/authorized_keys`
3. **VÃ©rifier les connexions SSH rÃ©centes** : `sudo lastlog`
4. **Mettre Ã  jour le systÃ¨me** : `sudo dnf update -y`
5. **VÃ©rifier les packages npm** : `bash verifier-apres-npm-install.sh`
