# ðŸš¨ NETTOYAGE COMPLET DU MALWARE system-check

## âš ï¸ PROCÃ‰DURE COMPLÃˆTE DE NETTOYAGE

ExÃ©cutez ces commandes dans l'ordre sur votre serveur EC2 :

### 1. ARRÃŠTER TOUS LES PROCESSUS MALVEILLANTS

```bash
# Tuer tous les processus system-check
pkill -9 system-check
ps aux | grep system-check | grep -v grep | awk '{print $2}' | xargs kill -9 2>/dev/null

# VÃ©rifier qu'ils sont bien arrÃªtÃ©s
ps aux | grep system-check | grep -v grep
```

### 2. SUPPRIMER TOUS LES FICHIERS MALVEILLANTS

```bash
# Supprimer le binaire
sudo rm -f /var/tmp/system-check
sudo rm -f /tmp/system-check

# Supprimer les logs
sudo rm -f /var/tmp/system-check.log
sudo rm -f /tmp/system-check.log

# Chercher et supprimer toutes les variantes
sudo find /var/tmp /tmp /home -name "*system-check*" -type f -delete 2>/dev/null
sudo find /var/tmp /tmp /home -name "*system*check*" -type f -delete 2>/dev/null
```

### 3. NETTOYER LES CRONTABS (EMPÃŠCHER LE REDÃ‰MARRAGE AUTOMATIQUE)

```bash
# VÃ©rifier les crontabs
crontab -l
sudo crontab -l

# Supprimer les entrÃ©es suspectes (remplacer par votre crontab propre)
# Si vous voyez des rÃ©fÃ©rences Ã  system-check, supprimez-les
crontab -e
# (Supprimez les lignes contenant system-check)

# VÃ©rifier les crontabs systÃ¨me
sudo ls -la /etc/cron.d/
sudo ls -la /etc/cron.daily/
sudo ls -la /etc/cron.hourly/
sudo grep -r "system-check" /etc/cron* 2>/dev/null
```

### 4. NETTOYER LES SERVICES SYSTEMD

```bash
# Chercher les services suspects
systemctl list-units --type=service --all | grep -i system-check
sudo systemctl list-unit-files | grep -i system-check

# DÃ©sactiver et supprimer les services suspects
sudo systemctl stop system-check 2>/dev/null
sudo systemctl disable system-check 2>/dev/null
sudo rm -f /etc/systemd/system/system-check.service
sudo rm -f /etc/systemd/system/system-check*.service
sudo systemctl daemon-reload
```

### 5. NETTOYER LES FICHIERS DE DÃ‰MARRAGE

```bash
# VÃ©rifier les fichiers de dÃ©marrage
sudo grep -r "system-check" /etc/rc*.d /etc/init.d /etc/systemd 2>/dev/null
sudo grep -r "system-check" ~/.bashrc ~/.bash_profile ~/.profile ~/.zshrc 2>/dev/null

# Supprimer les rÃ©fÃ©rences
# (Ã‰ditez manuellement les fichiers si des rÃ©fÃ©rences sont trouvÃ©es)
```

### 6. NETTOYER LES PROCESSUS EN ARRIÃˆRE-PLAN

```bash
# VÃ©rifier les processus nohup, screen, tmux
ps aux | grep -E "nohup|screen|tmux" | grep -v grep
jobs

# VÃ©rifier les processus zombies
ps aux | grep -E "defunct|Z+" | grep -v grep
```

### 7. PROTECTION PERMANENTE - CRÃ‰ER UN SERVICE DE SURVEILLANCE

```bash
# CrÃ©er un service systemd pour surveiller et bloquer system-check
sudo tee /etc/systemd/system/block-system-check.service > /dev/null << 'EOF'
[Unit]
Description=Bloque le malware system-check
After=network.target

[Service]
Type=oneshot
ExecStart=/bin/bash -c 'pkill -9 system-check; rm -f /var/tmp/system-check /tmp/system-check /var/tmp/system-check.log /tmp/system-check.log'
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
EOF

# CrÃ©er un timer pour exÃ©cuter la protection toutes les minutes
sudo tee /etc/systemd/system/block-system-check.timer > /dev/null << 'EOF'
[Unit]
Description=Timer pour bloquer system-check
Requires=block-system-check.service

[Timer]
OnBootSec=10s
OnUnitActiveSec=1min
Unit=block-system-check.service

[Install]
WantedBy=timers.target
EOF

# Activer et dÃ©marrer
sudo systemctl daemon-reload
sudo systemctl enable block-system-check.timer
sudo systemctl start block-system-check.timer

# VÃ©rifier
sudo systemctl status block-system-check.timer
```

### 8. PROTECTION AVEC CHROOT JAIL (OPTIONNEL - AVANCÃ‰)

```bash
# CrÃ©er un rÃ©pertoire isolÃ© pour /var/tmp
sudo chmod 1777 /var/tmp
sudo chattr +i /var/tmp/system-check 2>/dev/null || true
```

### 9. PROTECTION AVEC FIREWALL (BLOQUER LES CONNEXIONS SORTANTES SUSPECTES)

```bash
# VÃ©rifier les connexions rÃ©seau suspectes
sudo netstat -tulpn | grep -E "system-check|318032"

# Bloquer les connexions sortantes suspectes (si nÃ©cessaire)
# sudo iptables -A OUTPUT -m owner --uid-owner $(id -u ec2-user) -j DROP
# (Ã€ utiliser avec prÃ©caution)
```

### 10. VÃ‰RIFICATION FINALE

```bash
# VÃ©rifier qu'il n'y a plus de processus
ps aux | grep system-check | grep -v grep

# VÃ©rifier qu'il n'y a plus de fichiers
find /var/tmp /tmp /home -name "*system-check*" 2>/dev/null

# VÃ©rifier les crontabs
crontab -l | grep system-check
sudo crontab -l | grep system-check

# VÃ©rifier les services
systemctl list-units | grep system-check

# VÃ©rifier la mÃ©moire
free -h

# VÃ©rifier les processus les plus gourmands
ps aux --sort=-%mem | head -10
```

## âœ… RÃ‰SULTAT ATTENDU

AprÃ¨s ces Ã©tapes :
- âœ… Aucun processus `system-check` en cours
- âœ… Aucun fichier `system-check` sur le systÃ¨me
- âœ… Aucune entrÃ©e dans les crontabs
- âœ… Service de protection actif qui bloque automatiquement le malware
- âœ… Surveillance automatique toutes les minutes

## ðŸ”„ MAINTENANCE CONTINUE

```bash
# VÃ©rifier rÃ©guliÃ¨rement
ps aux | grep system-check | grep -v grep

# Voir les logs du service de protection
sudo journalctl -u block-system-check.service -n 50

# Voir l'Ã©tat du timer
sudo systemctl status block-system-check.timer
```

## ðŸš¨ SI LE MALWARE REVIENT

Si vous voyez `system-check` rÃ©apparaÃ®tre :

1. **Identifier la source** :
   ```bash
   # Voir d'oÃ¹ vient le processus
   ps auxf | grep system-check
   
   # Voir les fichiers ouverts par le processus
   sudo lsof -p $(pgrep system-check)
   
   # Voir les connexions rÃ©seau
   sudo netstat -tulpn | grep system-check
   ```

2. **Nettoyer Ã  nouveau** :
   ```bash
   pkill -9 system-check
   sudo rm -f /var/tmp/system-check /tmp/system-check
   ```

3. **Renforcer la protection** :
   - VÃ©rifier les packages npm : `npm audit`
   - VÃ©rifier les scripts dans `package.json`
   - VÃ©rifier les hooks git : `ls -la .git/hooks/`
   - Scanner avec un antivirus si disponible
