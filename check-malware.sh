#!/bin/bash

echo "üîç Recherche de redirections malveillantes..."

cd ~/bbyatchv2 || exit 1

# Rechercher dans tous les fichiers
echo ""
echo "1Ô∏è‚É£ Recherche du domaine suspect dans les fichiers..."
grep -r "claim-reward.solgalaxy.cc" . --exclude-dir=node_modules --exclude-dir=.next --exclude-dir=.git 2>/dev/null && echo "‚ö†Ô∏è  TROUV√â !" || echo "‚úÖ Non trouv√© dans le code source"

# V√©rifier les fichiers .env
echo ""
echo "2Ô∏è‚É£ V√©rification des fichiers .env..."
if [ -f .env ]; then
    grep -i "solgalaxy\|claim-reward" .env && echo "‚ö†Ô∏è  TROUV√â dans .env !" || echo "‚úÖ .env propre"
else
    echo "‚ÑπÔ∏è  Pas de fichier .env"
fi

# V√©rifier nginx
echo ""
echo "3Ô∏è‚É£ V√©rification de la configuration nginx..."
if [ -f /etc/nginx/sites-enabled/bbyatchv2 ]; then
    grep -i "solgalaxy\|claim-reward" /etc/nginx/sites-enabled/bbyatchv2 && echo "‚ö†Ô∏è  TROUV√â dans nginx !" || echo "‚úÖ Nginx propre"
elif [ -f /etc/nginx/sites-available/bbyatchv2 ]; then
    grep -i "solgalaxy\|claim-reward" /etc/nginx/sites-available/bbyatchv2 && echo "‚ö†Ô∏è  TROUV√â dans nginx !" || echo "‚úÖ Nginx propre"
else
    echo "‚ÑπÔ∏è  Configuration nginx non trouv√©e"
fi

# V√©rifier les fichiers HTML dans public
echo ""
echo "4Ô∏è‚É£ V√©rification des fichiers HTML dans public..."
find public -name "*.html" -type f 2>/dev/null | while read file; do
    if grep -q "solgalaxy\|claim-reward" "$file" 2>/dev/null; then
        echo "‚ö†Ô∏è  TROUV√â dans: $file"
    fi
done

# V√©rifier le dossier .next (build)
echo ""
echo "5Ô∏è‚É£ V√©rification du build .next (peut prendre du temps)..."
if [ -d .next ]; then
    find .next -type f -name "*.html" -o -name "*.js" 2>/dev/null | head -20 | while read file; do
        if grep -q "solgalaxy\|claim-reward" "$file" 2>/dev/null; then
            echo "‚ö†Ô∏è  TROUV√â dans: $file"
        fi
    done
fi

# V√©rifier les scripts dans package.json
echo ""
echo "6Ô∏è‚É£ V√©rification des scripts package.json..."
if [ -f package.json ]; then
    grep -i "solgalaxy\|claim-reward" package.json && echo "‚ö†Ô∏è  TROUV√â !" || echo "‚úÖ package.json propre"
fi

# V√©rifier les processus en cours
echo ""
echo "7Ô∏è‚É£ V√©rification des processus Node.js..."
ps aux | grep -E "node|next" | grep -v grep

echo ""
echo "‚úÖ V√©rifications termin√©es !"
echo ""
echo "üí° Si rien n'est trouv√©, la redirection peut √™tre dans:"
echo "   - Le build .next (reconstruire: npm run build)"
echo "   - La configuration nginx (v√©rifier manuellement)"
echo "   - Un fichier inject√© dans public/"
echo "   - Un middleware ou fichier de configuration Next.js"













